<?php extend('extend/extend'); ?>
<?php start('style'); ?>
<style type="text/css">
    .ui.attached.header{
        margin-top: 0;
    }
    .ui.toggle.checkbox input:checked~.box:before, .ui.toggle.checkbox input:checked~label:before{
        background-color: #2185D0 !important;
    }
    .ui.popup{
        padding: .3em .5em;
    }
    .icon.link{
        color: #000000;
    }
</style>
<?php stop(); ?>
<?php start('content'); ?>
<!--内容-->
<h3 class="ui top attached header">
    <i class="file text outline icon" style="font-size: 1.28em;margin-top: -3px;"></i> 文档管理
</h3>
<div class="ui attached segment">
<a class="ui blue basic button" href="/article-setting/add"><i class="tiny plus icon"></i> 添加</a>
<a class="ui red basic button" href="/article-setting/add"><i class="tiny remove icon"></i> 批量删除</a>
<table class="ui blue unstackable selectable celled table">
    <thead>
        <tr>
            <th>ID</th>
            <th>标题</th>
            <th>作者</th>
            <th>所属栏目</th>
            <th>是否显示</th>
            <th>创建时间</th>
            <th>操作</th>
        </tr>
    </thead>
    <tbody>
        <?php if (empty($pageData)): ?>
            <tr class="terse center">
                <td colspan="6">暂时没有任何文章</td>
            </tr>
        <?php endif ?>
        <?php $i=1; foreach ($pageData as $key => $val) { ?>
        <tr>
            <td class="collapsing"><?=$i++?></td>
            <td><?=$val['title']?></td>
            <td><a href="/article-setting/search?author=<?=$val['author']?>"><?=$val['author']?></a></td>
            <td><?=$val['column_id']?></td>
            <td>
                <span class="ui toggle checkbox">
                    <?php if ($val['is_show']): ?>
                    <input type="checkbox" name="public" checked="checked" data-id="<?=$key?>">
                    <label>显示</label>
                    <?php else: ?>
                    <input type="checkbox" name="public" data-id="<?=$key?>">
                    <label>隐藏</label>
                    <?php endif ?>
                </span>
            </td>
            <td><?=$val['create_time']?></td>
            <td style="font-size: 12px;">
                <i class="circular blue write icon link" data-content="编辑" data-position="bottom center" data-variation="inverted" data-action="/article-setting/edit?id=<?=$key?>"></i>
                <i class="circular blue unhide icon link" data-content="查看" data-position="bottom center" data-variation="inverted" data-action=""></i>
                <i class="circular blue trash outline icon link" data-content="删除" data-position="bottom center" data-variation="inverted" data-id="<?=$key?>"></i>
            </td>
        </tr>
        <?php } ?>
    </tbody>
</table>
    共 100 页
<?php pagination();?>
</div>
<div class="terse tip">
    <span style="margin: 0 5px;">这是一个小提示！</span>
    <i class="remove icon" style="margin-right: -10px;"></i>
</div>
<script type="text/javascript">
$(document).ready(function(){
    <?php if (!empty($msg)): ?>
    showTips("<?=$msg?>");
    <?php endif ?>
    //开启提示框
    $('.icon.link').popup({
        inline: true
    });

    //编辑
    $('.write.link').click(function(){
        var href = $(this).attr('data-action');
        window.open(href,'_self');
    });

    //删除
    $('.trash.link').click(function(){
        var id = $(this).attr('data-id');
        $.post('/article-setting/doDelete',{id},function(response){
            if (response['status'] == 200) {
                showTips(response['message']);
            }
        },'json');
    });

    for (var i = $('.toggle.checkbox').length - 1; i >= 0; i--) {
        $('.toggle.checkbox:eq('+i+')').checkbox().first().checkbox({
            onChecked: function() {
                var id = $(this).attr('data-id');
                var msg = '显示';
                $.post('/article-setting/changeVisible',{id,status:1}).success(function(){
                    showTips('文章显示成功！');
                }).error(function(){
                    msg = '隐藏';
                    showTips('文章显示失败！');
                });
                $(this).siblings('label').html(msg);
            },
            onUnchecked: function() {
                var id = $(this).attr('data-id');
                var msg = '隐藏';
                $.post('/article-setting/changeVisible',{id,status:0}).success(function(){
                    showTips('文章隐藏成功！');
                }).error(function(){
                    msg = '显示';
                    showTips('文章隐藏失败！');
                });
                $(this).siblings('label').html(msg);
            },
        });
    }
});
</script>
<?php stop(); ?>